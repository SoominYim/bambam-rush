# AGENT.md

## 0) 문서 목적
이 문서는 이 저장소에서 작업하는 에이전트(Codex 포함)의 실행 기준이다.
목표는 `품질을 유지한 빠른 개발`이며, 특히 `브랜치 -> PR -> 리뷰 -> 머지` 사이클을 누락 없이 완료하는 데 있다.

## 1) 핵심 목표
- 기본 개발 사이클: `브랜치 생성 -> 구현/검증 -> 원격 푸시 -> PR 생성 -> 리뷰 반영 -> 머지`
- 리뷰/이슈 사이클: `코드리뷰 -> 수정 가능한 항목 즉시 수정 -> 나머지 이슈 등록 -> PR에 연결`
- 완료 보고는 항상 `변경 파일/핵심 변경/검증 결과/남은 리스크`를 포함한다.

## 1-1) 도메인 문서 필수 확인 규칙 (자동화 강제)
- 모든 작업은 시작 전에 `AGENT.md`와 관련 `agents/*.md`를 반드시 확인한다.
- 관련 문서를 읽지 않고 구현/수정/리뷰를 진행하면 안 된다.
- 도메인이 2개 이상 걸치면 해당 문서를 모두 확인한다.
- 어떤 문서를 확인했는지 작업 보고에 명시한다.

도메인 매핑:
- 무기/스킬/투사체/밸런스/이펙트: `agents/weapon-agent.md`
- 일반몹/엘리트/보스/웨이브/AI: `agents/enemy-agent.md`
- HUD/메뉴/튜토리얼/피드백/UI 플로우: `agents/ui-agent.md`
- AI 이미지 생성/컨셉아트/프롬프트 엔지니어링: `agents/design-agent.md`
- 전투 규칙/성장/경제/드랍/진행 시스템: `agents/system-agent.md`
- VFX/연출/색/스타일 가이드: `agents/art-vfx-agent.md`
- SFX/BGM/믹싱/오디오 이벤트: `agents/audio-agent.md`
- 테스트/회귀/버그 재현/품질 게이트: `agents/qa-agent.md`
- 배포/릴리즈/버전/체인지로그: `agents/release-agent.md`

## 2) 프로젝트 정체성
- 장르: `Snake`류 + `뱀서(서바이버라이크)`류 결합
- 핵심 루프: 이동/회피/성장 + 다수 적 처리 + 빌드 선택의 재미
- 설계 우선순위: 재미 > 가독성 > 확장성 > 미세 최적화

## 3) 공통 운영 원칙
- 모든 설명/주석/리뷰/보고는 한국어로 작성한다.
- 요청 범위를 벗어난 변경은 하지 않는다.
- 사용자 요청 없는 파괴적 변경(`reset --hard`, 대규모 삭제/리셋, 강제 푸시)은 금지한다.
- 기존 사용자 변경사항은 임의로 되돌리지 않는다.
- 사용자의 명시적 지시가 있기 전에는 `push`, `PR 생성/수정`, `merge`를 실행하지 않는다.
- 원격 반영이 필요한 경우 먼저 로컬 변경/검증 결과를 보고하고 승인 후 진행한다.
- 변경 보고 시 아래 4가지를 포함한다.
  - 무엇을 바꿨는가
  - 왜 바꿨는가
  - 어떤 영향이 있는가
  - 어떻게 검증했는가

## 4) 베타 단계 개발 원칙
- "빨리 추가"보다 "나중에 쉽게 고칠 수 있는 구조"를 우선한다.
- 신규 기능은 `설정/로직/데이터`로 분리 가능한 형태로 작성한다.
- 하드코딩을 피하고 가능한 설정 기반으로 설계한다.
- 암묵적 동작보다 명시적 동작을 선택한다.

## 5) 무기 설계 원칙
### 5-1. 밸런스
- DPS 단일 지표가 아니라 `사거리/범위/쿨다운/투사체 속도/관통/군중제어/리스크`를 함께 평가한다.
- 초반(1~3분), 중반(4~8분), 후반(9분+) 성능을 분리해 확인한다.
- 목표는 "최강 무기"가 아니라 "선택할 이유가 있는 무기"다.

### 5-2. 컨셉 일관성
- 무기 테마, 사용감, 시각효과, 수치효과가 같은 방향을 보도록 설계한다.
- 컨셉과 상충하는 성능(예: 묵직한 무기의 과도한 연사)은 지양한다.
- 설명 문구와 실제 체감이 다르지 않게 만든다.

### 5-3. 장르 결합 적합성
- Snake류 요소(동선, 몸집/꼬리 리스크)와 상호작용하는지 확인한다.
- 뱀서류 요소(다수 적 처리, 성장 곡선, 빌드 조합)를 제공하는지 확인한다.
- 한쪽 장르만 강화하고 다른 쪽을 망가뜨리는 설계는 피한다.

### 5-4. 확장성
- 신규 무기 추가 시 코어 로직 수정이 최소화되도록 인터페이스를 유지한다.
- 무기 수치/동작 파라미터를 데이터화한다.
- 향후 업그레이드/시너지/변형을 고려해 필드를 설계한다.

### 5-5. 구현 체크리스트
- 무기 ID/타입/레지스트리 등록
- 기본 스탯(피해, 쿨다운, 범위 등) 정의
- 레벨 스케일링 규칙 정의
- 충돌/이펙트/사운드 연결 확인
- 툴팁/설명 텍스트 동기화
- 가능하면 "무기 하나 = 설정 한곳 + 로직 한곳" 구조를 유지
- 기존 무기와 컨셉/체감/패턴 중복 여부 사전 검토

### 5-6. 신규 무기 중복 금지 (강제)
- 신규 무기는 기존 무기와 `공격 루프`, `핵심 조작감`, `주요 판정 방식` 중 2개 이상이 겹치면 안 된다.
- 단순 원소/색상 변경은 신규 무기로 인정하지 않는다.
- 신규 제안 시 반드시 아래를 함께 작성한다.
  - 기존 유사 무기
  - 차별 포인트 3가지
  - 초반 단독 운용 시 공격 성립 근거

## 6) 코드 품질 원칙
- 기존 스타일을 우선 존중하고 불필요한 대규모 리팩터링은 피한다.
- 매직 넘버는 의미 있는 상수/설정값으로 분리한다.
- 복잡 로직에는 "왜 이렇게 했는지"를 짧게 주석으로 남긴다.
- 테스트/검증 없이 핵심 밸런스 로직을 변경하지 않는다.
- 장르 정체성을 훼손하는 임시 땜질식 구현을 지양한다.

## 7) GitHub 작업 표준 (브랜치/PR/머지)
### 7-1. 브랜치
- 브랜치명 규칙: `feat/<slug>`, `fix/<slug>`, `chore/<slug>`
- 기능/수정 단위마다 **항상 새 작업 브랜치**를 만든다.
- `main`에서 직접 개발/커밋/푸시를 금지한다.
- 작업 시작 시 현재 브랜치가 `main`이면, 구현 전에 즉시 작업 브랜치로 전환한다.
- 하나의 작업 브랜치는 하나의 PR 주제만 포함한다.

### 7-2. 커밋
- 커밋 메시지는 변경 의도가 드러나야 한다.
- 하나의 PR 주제와 무관한 변경을 섞지 않는다.

### 7-3. PR 생성 규칙
- PR 제목 형식: `[도메인] #<이슈번호> 간단 요약`
- PR 본문 최상단에 `## 변경 요약`을 둔다.
- PR 본문 필수 항목:
  - 변경 파일
  - 변경 이유
  - 기대 효과
  - 체크리스트(빌드/타입/린트)
- 이슈/카드 번호를 반드시 포함한다. (최소 1개 `#숫자`)

### 7-4. 머지 전 체크
- 리뷰 코멘트 actionable 항목을 전부 처리한다.
- `lint/typecheck/build` 중 가능한 검증을 수행한다.
- PR 본문의 이슈 번호와 실제 변경 내용이 일치해야 한다.

### 7-5. 머지
- 저장소 정책에 맞는 방식으로 머지한다.
- 머지 커밋 본문에 변경 이유와 영향 범위를 1줄 이상 기록한다.
- 머지 후 로컬 `main`을 최신 상태로 동기화한다.
- 머지는 반드시 PR 경로로만 수행한다. (`main` 직접 반영 금지)

## 8) CodeRabbit 리뷰 규칙 (강제)
### 8-1. 역할
- 에이전트는 기본적으로 `CodeRabbit` 역할로 PR 단위 상세 코드리뷰를 수행한다.
- 칭찬보다 `리스크/버그/회귀 가능성/누락 테스트` 식별을 우선한다.

### 8-2. 리뷰 작성 방식
- 리뷰 코멘트는 파일/라인 근거를 포함한다.
- 심각도 라벨을 사용한다: `critical`, `high`, `medium`, `low`.
- 최소 체크 항목:
  - 기능 정확성
  - 안정성(null/undefined/경계값/예외)
  - 성능(핫패스/불필요 연산)
  - 구조(응집도/결합도/중복)
  - 테스트 누락
  - 문서 정합성

### 8-3. 리뷰 결과 처리
- 즉시 수정 가능한 항목은 같은 브랜치에서 바로 수정 후 커밋한다.
- 범위가 크거나 의사결정이 필요한 항목은 GitHub Issue로 등록한다.

### 8-4. GitHub Issue 등록 규칙
- 코드리뷰에서 발견한 actionable 항목은 원칙적으로 Issue로 추적한다.
- 중복 이슈를 먼저 검색하고, 없을 때 생성한다.
- 제목 형식: `[CR][우선순위] 컴포넌트/파일 - 이슈 요약`
- Issue 본문 필수 항목:
  - 문제 요약
  - 재현 절차
  - 기대 동작 vs 실제 동작
  - 영향 범위
  - 제안 해결안
  - 우선순위(`critical/high/medium/low`)
- PR 본문 또는 리뷰 코멘트에 Issue 번호를 연결한다.

### 8-5. 머지 게이트
- `critical/high` 미해결 0건
- `medium/low` 미해결은 모두 Issue 등록 + 링크 완료
- 모든 리뷰 코멘트는 처리 근거(수정 또는 이슈 전환)를 남긴다.

## 9) 자동화 부족 항목 (우선순위)
### 9-1. 즉시 필요 (P0)
- PR 사전검증 GitHub Actions 강제
  - 항목: `lint`, `build` (가능하면 `typecheck` 스크립트 추가)
  - 목적: 로컬 누락 검증 차단
- 미해결 리뷰 스레드 차단 게이트
  - 목적: unresolved thread가 있으면 머지 금지
- PR 템플릿 표준화
  - 항목: 변경 요약/검증 결과/리스크/연결 이슈/리뷰 포인트 강제

### 9-2. 단기 필요 (P1)
- 브랜치명/커밋 메시지 규칙 검사 자동화
- 리뷰 발견 이슈의 라벨 자동 부여(`critical/high/medium/low`, `codereview`)
- PR에서 이슈 링크 누락 시 경고 체크

### 9-3. 중기 필요 (P2)
- 리뷰 코멘트 -> 이슈 초안 자동 생성(반자동)
- 문서-코드 정합성 스모크 체크(핵심 매핑만)
- 릴리즈 전 회귀 체크리스트 자동 생성

### 9-4. 인코딩/개행 안정화 (P0)
- `.gitattributes`로 텍스트 파일 개행 정책 고정 (`LF` 기준 권장)
- 에디터 인코딩 `UTF-8` 고정
- 목적: 한글 깨짐/CRLF 혼선 재발 방지

## 10) 작업 완료 보고 템플릿
- 변경 파일: (경로 나열)
- 핵심 변경: (한 줄 요약)
- 밸런스/컨셉 검토: (체크 결과)
- 검증 결과: (실행한 항목과 결과)
- 코드리뷰 결과: (심각도별 건수 + 처리 상태)
- 생성/연결 이슈: (#번호 나열)
- 남은 리스크: (있으면 명시)
