# Weapon Context – BamBam Rush

(필수 기준 문서 / 구현 전 반드시 숙지)

---

## 0. 이 문서의 목적

이 문서는 다음 문제를 해결하기 위해 존재한다:

- 첫 무기부터 에러가 난다
- 패턴이 뭔지 애매하다
- weaponRegistry / weaponSystem / projectile 책임이 섞인다
- “어디까지 구현해야 정상인지” 모른다

👉 **이 문서는 ‘무기를 어떻게 생각하고, 어디까지 만들어야 완성인지’를 정의한다**

---

## 1. 무기의 정의 (가장 중요)

BamBam Rush에서 **무기란**:

> ❌ 데미지를 주는 오브젝트  
> ⭕ “패턴 + 수치 + 상태”의 묶음이다

무기는 절대 단독 로직을 가지지 않는다.  
무기는 **패턴을 선택하고, 패턴에 데이터를 공급**할 뿐이다.

---

## 2. 무기 구성 요소 (필수)

모든 무기는 아래 4가지를 반드시 가진다.

### 2.1 Pattern (행동 방식)

- orbit, projectile, area 등
- “어떻게 공격하는가”

### 2.2 BaseStats (기본 수치)

- damage, cooldown, count, size 등
- **패턴이 소비하는 재료**

### 2.3 Level Scaling (성장 규칙)

- 레벨업 시 무엇이 변하는가
- 수치만 변한다 (행동 ❌)

### 2.4 State (상태, 선택)

- idle / attack / return 등
- 패턴 내부 개념
- weaponRegistry에는 상태가 없다

---

## 3. weaponRegistry.ts의 책임 (절대 넘기지 말 것)

### weaponRegistry.ts는 오직 “데이터”다

허용되는 것:

- pattern 이름
- 수치
- 레벨 스케일
- 진화 조건

금지되는 것:

- if 문
- 거리 계산
- 적 탐색
- update 로직
- 상태 판단

👉 **여기에 로직이 들어가면 100% 나중에 터진다**

---

## 4. 패턴의 진짜 의미

### 패턴이란?

> “이 무기는 게임 월드에서 어떤 방식으로 존재하는가”

예시:

- projectile  
  → 생성되고 날아가 사라진다
- orbit  
  → 항상 플레이어 주변에 존재한다
- aura  
  → 플레이어에 귀속된 영역이다

👉 패턴 = **존재 방식**

---

## 5. 패턴 구현 레벨 기준 (중요)

각 패턴은 **최소 이 정도까지만 구현하면 된다**

### 5.1 ORBIT 패턴 (예: 첫 무기)

**반드시 구현해야 하는 것**

- 플레이어 기준 회전
- 반경(radius)
- 각도(angle) 누적
- 적과 충돌 시 데미지

**아직 구현하지 않아도 되는 것**

- 적 탐지
- 전진
- 상태 변화
- 진화 효과

👉 첫 무기는 **“가만히 도는 칼”만 돼도 성공**

---

### 5.2 PROJECTILE 패턴

필수:

- 방향
- 속도
- 수명 or 화면 밖 제거

선택:

- 추적
- 관통
- 튕김

---

### 5.3 AREA / AURA 패턴

필수:

- 중심 좌표
- 반경
- tick 단위 데미지

선택:

- 이동
- 흡인
- 상태 부여

---

## 6. weaponSystem.ts의 책임 (많이 헷갈리는 부분)

weaponSystem.ts는 **“언제 생성하느냐”만 담당**한다.

### weaponSystem.ts가 하는 일

- 쿨타임 체크
- count만큼 생성
- 패턴에 맞는 생성 함수 호출

### weaponSystem.ts가 하면 안 되는 일

- 회전 계산
- 이동 계산
- 적 찾기
- 충돌 처리

👉 여기서 에러 나면 대부분 **책임 초과**

---

## 7. projectile / entity의 책임

여기가 **실제 전투 로직의 본체**다.

### 여기서만 허용되는 것

- update(dt)
- 위치 변경
- 상태 전환
- 충돌 판정
- hitCooldown

👉 “왜 안 맞지?” 문제는 90% 여기

---

## 8. 첫 무기 제작 체크리스트 (중요 ⭐)

첫 무기를 만들 때 아래를 전부 만족하면 **성공**이다.

### 데이터

- [ ] weaponRegistry에 정의됨
- [ ] pattern이 존재함
- [ ] baseStats가 비어있지 않음

### 시스템

- [ ] weaponSystem에서 해당 패턴 분기됨
- [ ] 생성 함수가 호출됨

### 엔티티

- [ ] 화면에 나타남
- [ ] 움직이거나 유지됨
- [ ] 적과 충돌 시 데미지 발생

❌ 레벨업, 진화, 시너지 아직 신경 쓰지 마라

---

## 9. 자주 터지는 실수 TOP 5

1. weaponRegistry에 로직을 넣음
2. 패턴 구현 전에 상태를 넣음
3. 첫 무기에 “전진 + 감지”를 넣음
4. weaponSystem에서 이동 계산
5. projectile 하나로 모든 패턴 처리

👉 **첫 무기는 무조건 단순해야 한다**

---

## 10. 개발 순서 권장안 (실전)

1️⃣ orbit (정적 회전)  
2️⃣ projectile (직선)  
3️⃣ area (고정 장판)  
4️⃣ orbit + 상태  
5️⃣ 나머지 패턴 확장

---

## 11. 이 문서의 한 줄 정의

> 무기는 “기능”이 아니라  
> **패턴이 수치를 소비하는 구조물**이다
